<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Happy Birthday My Love!</title>
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Google Fonts for "Dancing Script" -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* General Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
        min-height: 100vh;
        overflow-x: hidden;
        color: #5a3e36;
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
      }

      @keyframes gradientBG {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* Surprise Overlay */
      .surprise-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, #ff6b6b, #6c5ce7, #00cec9);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        transition: opacity 1s ease;
      }

      .surprise-content {
        text-align: center;
        color: white;
        padding: 30px;
        max-width: 800px;
      }

      .surprise-title {
        font-size: 4rem;
        margin-bottom: 30px;
        text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        animation: pulse 2s infinite;
      }

      .surprise-gift {
        font-size: 10rem;
        margin: 40px 0;
        cursor: pointer;
        transform-origin: center;
        transition: all 0.5s ease;
        animation: float 3s ease-in-out infinite;
        z-index: 1001;
        position: relative;
      }

      .surprise-gift:hover {
        transform: scale(1.2);
      }

      .surprise-gift.gift-open {
        animation: shake 0.5s ease, openBox 1s ease forwards 0.5s;
      }

      .surprise-message {
        font-size: 1.8rem;
        margin-bottom: 30px;
        line-height: 1.6;
      }

      .click-hint {
        font-size: 1.5rem;
        background: rgba(255, 255, 255, 0.2);
        padding: 15px 30px;
        border-radius: 50px;
        animation: bounce 2s infinite;
      }

      /* Floating Hearts */
      .floating-hearts {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
      }

      .heart {
        position: absolute;
        font-size: 24px;
        color: rgba(255, 105, 180, 0.7);
        animation: floatUp 8s linear forwards;
      }

      /* Main Content */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        position: relative;
        z-index: 10;
        opacity: 0;
        transform: scale(0.95);
        transition: all 1.5s ease;
        padding: 20px;
      }

      .container.show {
        opacity: 1;
        transform: scale(1);
      }

      /* Header */
      header {
        text-align: center;
        padding: 40px 20px;
        margin-bottom: 30px;
        position: relative;
      }

      .main-title {
        font-size: 3.5rem;
        color: #d63384;
        margin-bottom: 20px;
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.1);
      }

      .subtitle {
        font-size: 1.8rem;
        color: #6c5ce7;
        margin-bottom: 30px;
      }

      .heart-divider {
        font-size: 2.5rem;
        color: #ff6b6b;
        margin: 20px 0;
        animation: pulse 2s infinite;
      }

      /* Countdown */
      .countdown-section {
        background: rgba(255, 255, 255, 0.85);
        border-radius: 20px;
        padding: 30px;
        margin: 30px auto;
        max-width: 800px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
      }

      .countdown-title {
        font-size: 1.8rem;
        color: #d63384;
        margin-bottom: 20px;
      }

      .countdown-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
      }

      .countdown-box {
        background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        color: white;
        width: 120px;
        height: 120px;
        border-radius: 15px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      }

      .countdown-value {
        font-size: 2.5rem;
        font-weight: 700;
      }

      .countdown-label {
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      /* Photo Gallery */
      .photo-gallery {
        background: rgba(255, 255, 255, 0.85);
        border-radius: 20px;
        padding: 40px 20px;
        margin: 40px auto;
        max-width: 1000px;
        text-align: center;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
      }

      .gallery-title {
        color: #d63384;
        font-size: 2rem;
        margin-bottom: 30px;
      }

      .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
      }

      .gallery-item {
        overflow: hidden;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        transition: all 0.4s ease;
        height: 250px;
        position: relative;
        cursor: pointer;
      }

      .gallery-item:hover {
        transform: translateY(-10px) scale(1.03);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
      }

      .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
      }

      .gallery-item:hover img {
        transform: scale(1.1);
      }

      /* Lightbox Modal */
      .lightbox {
        display: none;
        position: fixed;
        z-index: 2000;
        padding-top: 60px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.9);
      }

      .lightbox-content {
        margin: auto;
        display: block;
        width: 80%;
        max-width: 700px;
        animation-name: zoom;
        animation-duration: 0.6s;
      }

      @keyframes zoom {
        from {
          transform: scale(0);
        }
        to {
          transform: scale(1);
        }
      }

      .close {
        position: absolute;
        top: 15px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        transition: 0.3s;
      }

      .close:hover,
      .close:focus {
        color: #bbb;
        text-decoration: none;
        cursor: pointer;
      }

      /* Gift Section */
      .gift-section {
        background: rgba(255, 255, 255, 0.85);
        border-radius: 20px;
        padding: 40px;
        margin: 40px auto;
        max-width: 900px;
        text-align: center;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
      }

      .gift-title {
        color: #d63384;
        font-size: 2rem;
        margin-bottom: 30px;
      }

      .gift-grid {
        display: flex;
        justify-content: center;
        gap: 40px;
        flex-wrap: wrap;
      }

      .gift-card {
        background: linear-gradient(135deg, #6c5ce7, #a29bfe);
        padding: 25px;
        border-radius: 20px;
        width: 220px;
        height: 240px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        font-weight: bold;
        transition: all 0.4s ease;
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
        position: relative;
        overflow: hidden;
      }

      .gift-card:hover {
        transform: scale(1.05);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }

      .gift-box {
        font-size: 4rem;
        margin-bottom: 20px;
        transition: all 0.5s ease;
        animation: pulse 2s infinite;
      }

      .gift-name {
        font-size: 1.5rem;
        margin-top: 10px;
      }

      /* Animation: gift opening */
      .gift-open .gift-box {
        animation: shake 0.5s ease, openBox 1s ease forwards 0.5s;
      }

      .gift-open .gift-name {
        opacity: 0;
      }

      .gift-reveal {
        font-size: 3.5rem;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
        animation: revealGift 0.8s ease forwards 1.3s;
      }

      .gift-message {
        margin-top: 30px;
        font-size: 1.5rem;
        color: #6c5ce7;
        min-height: 50px;
        font-weight: 600;
      }

      /* New Message Section Styles */
      .message-section {
        background: rgba(255, 255, 255, 0.85);
        border-radius: 20px;
        padding: 40px;
        margin: 40px auto;
        max-width: 800px;
        text-align: center;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
      }

      .message-title {
        color: #d63384;
        font-size: 2rem;
        margin-bottom: 25px;
      }

      .message-buttons {
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .message-button {
        padding: 12px 25px;
        border-radius: 50px;
        border: none;
        background: linear-gradient(45deg, #ff6b6b, #ff4757);
        color: white;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }

      .message-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
      }

      .message-button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .love-message {
        font-size: 1.3rem;
        line-height: 1.8;
        margin-bottom: 20px;
        text-align: center;
        min-height: 100px; /* Ensure space for the message */
      }

      .loading-message {
        font-style: italic;
        color: #888;
        opacity: 0;
        transition: opacity 0.5s ease;
      }

      .loading-message.visible {
        opacity: 1;
      }

      .signature {
        font-family: "Dancing Script", cursive;
        font-size: 2.2rem;
        color: #ff6b6b;
        margin-top: 20px;
      }

      /* Wishes Section */
      .wish-display {
        font-size: 1.3rem;
        font-style: italic;
        color: #6c5ce7;
        margin-top: 20px;
        min-height: 40px;
        animation: fadeIn 1s ease;
      }

      .wish-button {
        padding: 12px 25px;
        border-radius: 50px;
        border: none;
        background: linear-gradient(45deg, #f9ca24, #ffa502);
        color: white;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        margin-top: 20px;
      }

      .wish-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes floatUp {
        0% {
          transform: translateY(100vh) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(-100px) rotate(360deg);
          opacity: 0;
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      @keyframes shake {
        0%,
        100% {
          transform: rotate(0);
        }
        25% {
          transform: rotate(10deg);
        }
        50% {
          transform: rotate(-10deg);
        }
        75% {
          transform: rotate(5deg);
        }
      }

      @keyframes openBox {
        0% {
          transform: scale(1) rotate(0);
        }
        100% {
          transform: scale(0) rotate(720deg);
          opacity: 0;
        }
      }

      @keyframes revealGift {
        0% {
          transform: translate(-50%, -50%) scale(0);
          opacity: 0;
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      /* Confetti animation for the burst */
      @keyframes fall {
        0% {
          transform: translateY(-20px) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(720deg);
          opacity: 0;
        }
      }

      /* New Confetti and Sparkle from user */
      .confetti {
        position: absolute;
        animation: fall 3s forwards;
      }
      .square {
        border-radius: 0;
      }
      .circle {
        border-radius: 50%;
      }

      .sparkle {
        position: absolute;
        animation: sparkle 2.5s forwards;
      }

      @keyframes sparkle {
        0% {
          transform: scale(0.5);
          opacity: 0;
        }
        20% {
          opacity: 1;
        }
        100% {
          transform: scale(1.5);
          opacity: 0;
          transform: translateY(-150px);
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .main-title {
          font-size: 2.5rem;
        }
        .surprise-title {
          font-size: 3rem;
        }
        .subtitle {
          font-size: 1.4rem;
        }
        .surprise-message {
          font-size: 1.5rem;
        }
        .countdown-box {
          width: 100px;
          height: 100px;
        }
        .countdown-value {
          font-size: 2rem;
        }
        .gift-grid {
          gap: 20px;
        }
        .gift-card {
          width: 180px;
          height: 200px;
        }
      }

      @media (max-width: 480px) {
        .main-title {
          font-size: 2rem;
        }
        .surprise-title {
          font-size: 2.5rem;
        }
        .surprise-message {
          font-size: 1.2rem;
        }
        .surprise-gift {
          font-size: 7rem;
        }
        .countdown-box {
          width: 80px;
          height: 80px;
        }
        .countdown-value {
          font-size: 1.8rem;
        }
        .gift-card {
          width: 140px;
          height: 160px;
        }
        .gift-box {
          font-size: 3rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Surprise Overlay -->
    <div class="surprise-overlay" id="surpriseOverlay">
      <div class="surprise-content">
        <h1 class="surprise-title">Surprise, My Sujata Pagalni Budi!</h1>
        <div class="surprise-gift" id="surpriseGift">🎁</div>
        <p class="surprise-message">
          I have something special for you on your birthday
        </p>
        <p class="click-hint">Click the gift to reveal your surprise!</p>
      </div>
    </div>

    <!-- Floating Hearts -->
    <div class="floating-hearts" id="floatingHearts"></div>

    <!-- Lightbox Modal for Gallery -->
    <div id="lightbox" class="lightbox" onclick="closeLightbox()">
      <span class="close">&times;</span>
      <img
        class="lightbox-content"
        id="lightbox-img"
        src=""
        alt="Enlarged gallery image"
      />
    </div>

    <!-- Main Content -->
    <div class="container" id="mainContainer">
      <header>
        <h1 class="main-title">Happy Birthday, My Beautiful Wife!</h1>
        <p class="subtitle">
          You are the love of my life and my greatest blessing ❤️
        </p>
        <div class="heart-divider">💖</div>
      </header>

      <section class="countdown-section">
        <h2 class="countdown-title">Time Until Your Special Day</h2>
        <div class="countdown-container">
          <div class="countdown-box">
            <div class="countdown-value" id="days">00</div>
            <div class="countdown-label">Days</div>
          </div>
          <div class="countdown-box">
            <div class="countdown-value" id="hours">00</div>
            <div class="countdown-label">Hours</div>
          </div>
          <div class="countdown-box">
            <div class="countdown-value" id="minutes">00</div>
            <div class="countdown-label">Minutes</div>
          </div>
          <div class="countdown-box">
            <div class="countdown-value" id="seconds">00</div>
            <div class="countdown-label">Seconds</div>
          </div>
        </div>
      </section>

      <section class="message-section">
        <h2 class="message-title">To My Amazing Wife</h2>
        <p class="love-message" id="loveMessage">
          On this special day, I want you to know how much you mean to me. Your
          smile lights up my world, your laughter is my favorite melody, and
          your love is my greatest treasure. Every moment with you is a gift I
          cherish deeply. Thank you for being my partner, my best friend, and my
          soulmate. May this birthday be as beautiful and special as you are, my
          love.
        </p>
        <div class="message-buttons">
          <button class="message-button" onclick="generateMessage()">
            ✨ Generate a New Message
          </button>
          <button class="message-button" onclick="playAudioMessage()">
            ✨ Play a Birthday Message
          </button>
        </div>

        <h3 style="color: #d63384; margin-top: 30px">
          ✨ Special Messages Just for You
        </h3>
        <button class="wish-button" onclick="showRandomWish()">
          Click for Surprise 💖
        </button>
        <div class="wish-display" id="wishDisplay">
          Click above for a surprise!
        </div>

        <div class="signature">Forever Yours</div>
      </section>

      <section class="photo-gallery">
        <h2 class="gallery-title">Our Beautiful Memories Together</h2>
        <div class="gallery-grid" id="gallery-grid">
          <div
            class="gallery-item"
            onclick="openLightbox('https://placehold.co/800x600/FF6B6B/FFFFFF?text=Memory+1')"
          >
            <img src="IMG_20211013_141851.jpg" alt="Wedding" />
          </div>
          <div
            class="gallery-item"
            onclick="openLightbox('https://placehold.co/800x600/6C5CE7/FFFFFF?text=Memory+2')"
          >
            <img src="IMG_20211124_000104.jpg" alt="birthday" />
          </div>
          <div
            class="gallery-item"
            onclick="openLightbox('https://placehold.co/800x600/00CEC9/FFFFFF?text=Memory+3')"
          >
            <img src="IMG_20211127_132503.jpg" alt="Celebration" />
          </div>
          <div
            class="gallery-item"
            onclick="openLightbox('https://placehold.co/800x600/FAD0C4/5A3E36?text=Memory+4')"
          >
            <img src="IMG_20211128_105757_Original.JPG" alt="Special moments" />
          </div>
        </div>
      </section>

      <section class="gift-section" id="giftSection">
        <h2 class="gift-title">🎁 Choose Your Birthday Gift</h2>
        <div class="gift-grid">
          <div class="gift-card" onclick="openGift(this, 'AirPod', '🎧')">
            <div class="gift-box">🎁</div>
            <div class="gift-name">AirPod</div>
          </div>
          <div class="gift-card" onclick="openGift(this, 'Watch', '⌚')">
            <div class="gift-box">🎁</div>
            <div class="gift-name">Watch</div>
          </div>
        </div>
        <div class="gift-message" id="giftMessage"></div>
      </section>
    </div>

    <script>
      // API key is an empty string and will be filled by the Canvas runtime
      const apiKey = "";
      const textGenModel = "gemini-2.5-flash-preview-05-20";
      const ttsModel = "gemini-2.5-flash-preview-tts";

      // Keep track of the currently playing audio
      let currentAudio = null;

      // Array of predefined birthday wishes
      const birthdayWishes = [
        "Dharai chiauni hoina",
        "Khana darai khani sukera haddi huni haina",
        "Your love makes my heart sing 🎵",
        "You are my forever 💫",
        "My life began when I met you ❤️",
        "You make every day brighter ✨",
        "I love you more than words can express 💌",
        "You are my dream come true 🌈",
      ];

      // Function to show a temporary loading message
      function showLoading(message) {
        const msgElement = document.getElementById("loveMessage");
        msgElement.textContent = message;
      }

      // Function to generate a new birthday message using the Gemini API
      async function generateMessage() {
        const prompt =
          "Write a heartfelt and poetic birthday message for a wife. The message should be about 100 words and express deep love and appreciation.";
        const payload = {
          contents: [{ parts: [{ text: prompt }] }],
        };

        const buttons = document.querySelectorAll(".message-button");
        buttons.forEach((btn) => (btn.disabled = true));
        showLoading("Generating a new message for you...");

        try {
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${textGenModel}:generateContent?key=${apiKey}`;
          const response = await fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(
              errorData.error.message || `API error: ${response.status}`
            );
          }

          const result = await response.json();
          const generatedText =
            result?.candidates?.[0]?.content?.parts?.[0]?.text;

          if (generatedText) {
            document.getElementById("loveMessage").textContent =
              generatedText.trim();
          } else {
            document.getElementById("loveMessage").textContent =
              "Sorry, I couldn't generate a new message. Please try again.";
          }
        } catch (error) {
          console.error("Error generating message:", error);
          document.getElementById("loveMessage").textContent =
            "An error occurred. Please try again later.";
        } finally {
          buttons.forEach((btn) => (btn.disabled = false));
        }
      }

      // Function to convert base64 PCM audio data to a WAV Blob
      function pcmToWav(pcm16, sampleRate) {
        const pcmData = new Int16Array(pcm16);
        const buffer = new ArrayBuffer(44 + pcmData.byteLength);
        const view = new DataView(buffer);

        function writeString(view, offset, string) {
          for (let i = 0; i < string.length; i++) {
            view.setUint8(offset + i, string.charCodeAt(i));
          }
        }

        let offset = 0;
        // RIFF chunk descriptor
        writeString(view, offset, "RIFF");
        offset += 4;
        view.setUint32(offset, 36 + pcmData.byteLength, true);
        offset += 4;
        writeString(view, offset, "WAVE");
        offset += 4;

        // fmt chunk
        writeString(view, offset, "fmt ");
        offset += 4;
        view.setUint32(offset, 16, true);
        offset += 4;
        view.setUint16(offset, 1, true);
        offset += 2; // PCM format
        view.setUint16(offset, 1, true);
        offset += 2; // 1 channel
        view.setUint32(offset, sampleRate, true);
        offset += 4;
        view.setUint32(offset, sampleRate * 2, true);
        offset += 4; // Byte rate
        view.setUint16(offset, 2, true);
        offset += 2; // block align
        view.setUint16(offset, 16, true);
        offset += 2; // bits per sample

        // data chunk
        writeString(view, offset, "data");
        offset += 4;
        view.setUint32(offset, pcmData.byteLength, true);
        offset += 4;

        // Write PCM data
        for (let i = 0; i < pcmData.length; i++) {
          view.setInt16(offset + i * 2, pcmData[i], true);
        }

        return new Blob([view], { type: "audio/wav" });
      }

      // Function to play a birthday message using the Gemini TTS API
      async function playAudioMessage() {
        const prompt =
          "Say cheerfully: Happy Birthday my love! I hope you have a beautiful day. You are the best thing that ever happened to me.";
        const payload = {
          contents: [{ parts: [{ text: prompt }] }],
          generationConfig: {
            responseModalities: ["AUDIO"],
            speechConfig: {
              voiceConfig: {
                prebuiltVoiceConfig: { voiceName: "Puck" },
              },
            },
          },
        };

        const buttons = document.querySelectorAll(".message-button");
        buttons.forEach((btn) => (btn.disabled = true));
        showLoading("Playing your special birthday message...");

        // Stop any currently playing audio before starting a new one
        if (currentAudio) {
          currentAudio.pause();
          currentAudio.currentTime = 0;
          currentAudio = null;
        }

        try {
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${ttsModel}:generateContent?key=${apiKey}`;
          const response = await fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(
              errorData.error.message || `API error: ${response.status}`
            );
          }

          const result = await response.json();
          const part = result?.candidates?.[0]?.content?.parts?.[0];
          const audioData = part?.inlineData?.data;
          const mimeType = part?.inlineData?.mimeType;

          if (audioData && mimeType && mimeType.startsWith("audio/")) {
            const pcmData = atob(audioData)
              .split("")
              .map((char) => char.charCodeAt(0));
            const pcm16 = new Int16Array(new Uint8Array(pcmData).buffer);
            const sampleRate = 24000;
            const wavBlob = pcmToWav(pcm16, sampleRate);
            const audioUrl = URL.createObjectURL(wavBlob);

            currentAudio = new Audio(audioUrl);
            currentAudio.play();
            currentAudio.onended = () => {
              buttons.forEach((btn) => (btn.disabled = false));
              document.getElementById("loveMessage").textContent =
                "Playback finished.";
            };
          } else {
            document.getElementById("loveMessage").textContent =
              "Sorry, I couldn't generate the audio message. Please try again.";
          }
        } catch (error) {
          console.error("Error playing audio message:", error);
          document.getElementById("loveMessage").textContent =
            "An error occurred. Please try again later.";
        }
      }

      // Function to create a single floating heart
      function createFloatingHeart() {
        const heart = document.createElement("div");
        heart.className = "heart";
        heart.innerHTML = "💖";
        heart.style.left = Math.random() * 100 + "vw";
        heart.style.animationDuration = Math.random() * 5 + 5 + "s";
        document.getElementById("floatingHearts").appendChild(heart);

        // Remove heart after animation completes
        setTimeout(() => {
          heart.remove();
        }, 8000);
      }

      // Function to create a single confetti piece
      function createConfetti(x, y) {
        const confetti = document.createElement("div");
        confetti.className =
          "confetti " + (Math.random() > 0.5 ? "circle" : "square");
        const colors = [
          "#ff4757",
          "#ffa502",
          "#2ed573",
          "#1e90ff",
          "#e84393",
          "#f9ca24",
        ];
        confetti.style.background =
          colors[Math.floor(Math.random() * colors.length)];
        confetti.style.left = x + "px";
        confetti.style.top = y + "px";
        confetti.style.width = confetti.style.height =
          Math.random() * 8 + 6 + "px";
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 3000);
      }

      // Function to create a single sparkle
      function createSparkle(x, y) {
        const sparkle = document.createElement("div");
        sparkle.className = "sparkle";
        const emojis = ["✨", "🌟", "💫", "�", "🎊"];
        sparkle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        sparkle.style.left = x + "px";
        sparkle.style.top = y + "px";
        sparkle.style.fontSize = Math.random() * 15 + 15 + "px";
        document.body.appendChild(sparkle);
        setTimeout(() => sparkle.remove(), 2500);
      }

      // Function to display a random wish
      function showRandomWish() {
        const wishDisplay = document.getElementById("wishDisplay");
        const randomIndex = Math.floor(Math.random() * birthdayWishes.length);
        wishDisplay.textContent = birthdayWishes[randomIndex];
        createSparkle(event.clientX, event.clientY);
        createConfettiBurstFromPoint(event.clientX, event.clientY);
      }

      // Function to update the countdown timer
      function updateCountdown() {
        // Set birthday to tomorrow at 00:00:00
        const now = new Date();
        const birthday = new Date();
        birthday.setDate(now.getDate() + 1);
        birthday.setHours(0, 0, 0, 0);

        const diff = birthday - now;

        // If birthday has arrived, stop the countdown
        if (diff <= 0) {
          document.getElementById("days").textContent = "00";
          document.getElementById("hours").textContent = "00";
          document.getElementById("minutes").textContent = "00";
          document.getElementById("seconds").textContent = "00";
          return;
        }

        // Calculate time components
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor(
          (diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
        );
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        // Update display with leading zeros
        document.getElementById("days").textContent = days
          .toString()
          .padStart(2, "0");
        document.getElementById("hours").textContent = hours
          .toString()
          .padStart(2, "0");
        document.getElementById("minutes").textContent = minutes
          .toString()
          .padStart(2, "0");
        document.getElementById("seconds").textContent = seconds
          .toString()
          .padStart(2, "0");
      }

      // Function to handle the smaller gift box opening
      function openGift(element, giftName, giftEmoji) {
        // Prevent opening the same gift multiple times
        if (element.classList.contains("gift-open")) return;

        // Add class to trigger CSS animation
        element.classList.add("gift-open");

        // Create the gift reveal emoji
        const reveal = document.createElement("div");
        reveal.className = "gift-reveal";
        reveal.textContent = giftEmoji;
        element.appendChild(reveal);

        // Show a message after the animation completes
        setTimeout(() => {
          document.getElementById(
            "giftMessage"
          ).textContent = `🎉 You chose ${giftName}! Happy Birthday, my love ❤️`;
        }, 2000);
      }

      // Function to open the main surprise gift
      function openSurpriseGift() {
        const gift = document.getElementById("surpriseGift");
        const overlay = document.getElementById("surpriseOverlay");
        const container = document.getElementById("mainContainer");

        // Add a class to the gift to trigger its opening animation
        gift.classList.add("gift-open");

        // Create the confetti effect
        createConfettiBurst();

        // After the animations, reveal the main content
        setTimeout(() => {
          overlay.style.opacity = "0";
          container.classList.add("show");

          // Remove the overlay from the DOM after the transition is complete
          setTimeout(() => {
            overlay.style.display = "none";
          }, 1000);
        }, 1500); // Wait for animations to finish before revealing
      }

      // Function to create a burst of confetti from a single point
      function createConfettiBurstFromPoint(x, y) {
        for (let i = 0; i < 50; i++) {
          createConfetti(x, y);
        }
      }

      // Function to create a burst of confetti (for the main surprise)
      function createConfettiBurst() {
        const colors = ["#ff6b6b", "#f9ca24", "#6c5ce7", "#00cec9", "#ff4757"];
        const overlay = document.getElementById("surpriseOverlay");

        for (let i = 0; i < 150; i++) {
          const confetti = document.createElement("div");
          confetti.style.position = "absolute";
          confetti.style.width = "10px";
          confetti.style.height = "10px";
          confetti.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];
          confetti.style.borderRadius = Math.random() > 0.5 ? "50%" : "0";
          confetti.style.left = Math.random() * 100 + "vw";
          confetti.style.top = "-20px";
          confetti.style.opacity = "0.8";

          // Set up the animation
          confetti.style.animation = `fall ${
            Math.random() * 3 + 2
          }s linear forwards`;

          overlay.appendChild(confetti);

          // Remove the confetti after its animation
          setTimeout(() => {
            confetti.remove();
          }, 5000);
        }
      }

      // Function to open the lightbox with a specific image
      function openLightbox(src) {
        const lightbox = document.getElementById("lightbox");
        const lightboxImg = document.getElementById("lightbox-img");
        lightbox.style.display = "block";
        lightboxImg.src = src;
      }

      // Function to close the lightbox
      function closeLightbox() {
        const lightbox = document.getElementById("lightbox");
        lightbox.style.display = "none";
      }

      // Run code on page load
      document.addEventListener("DOMContentLoaded", () => {
        // Set up the surprise gift click handler
        const surpriseGift = document.getElementById("surpriseGift");
        surpriseGift.addEventListener("click", openSurpriseGift);

        // Initialize and start the countdown
        updateCountdown();
        setInterval(updateCountdown, 1000);

        // Initial burst of floating hearts
        for (let i = 0; i < 20; i++) {
          setTimeout(() => {
            createFloatingHeart();
          }, i * 300);
        }

        // Continue creating hearts at a regular interval
        setInterval(createFloatingHeart, 2000);
      });
    </script>
  </body>
</html>
�
